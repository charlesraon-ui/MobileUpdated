# render.yaml  (place this at the repo root)
services:
  - type: web
    name: GoAgriTrading-backend
    env: node
    rootDir: backend            # run everything from /backend
    buildCommand: |
      corepack enable || true   # no-op if not available
      npm install --legacy-peer-deps
    startCommand: npm start     # must exist in backend/package.json
    healthCheckPath: /healthz
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: DEBUG_LOG_OTP
        value: "1"
      - key: PORT
        value: 5000
      - key: APP_URL
        value: https://goagritrading-backend.onrender.com
      - key: API_URL
        value: https://goagritrading-backend.onrender.com
      - key: EXPO_PUBLIC_API_URL
        value: https://goagritrading-backend.onrender.com
      - key: ALLOW_DIRECT_REG_WHEN_EMAIL_DISABLED
        value: "1"
      - key: FRONTEND_SUCCESS_URL
        value: goagritrading://payment-success
      - key: FRONTEND_FAILED_URL
        value: goagritrading://payment-failed
      - key: CORS_ORIGIN
        value: http://localhost:8081,https://goagritrading-backend.onrender.com,*
      # Sensitive environment variables (set these in Render dashboard):
      # - key: MONGO_URI
      #   sync: false
      # - key: JWT_SECRET
      #   sync: false
      # - key: PAYMONGO_PUBLIC_KEY
      #   sync: false
      # - key: PAYMONGO_SECRET_KEY
      #   sync: false
      # - key: CLOUDINARY_CLOUD_NAME
      #   sync: false
      # - key: CLOUDINARY_API_KEY
      #   sync: false
      # - key: CLOUDINARY_API_SECRET
      #   sync: false
      # - key: CLOUDINARY_ROOT_FOLDER
      #   sync: false
